{"version":3,"file":"demo1009.js","sources":["pages/demo1009/demo1009.vue","E:/movie/HBuilderX.4.57.2025032507/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvZGVtbzEwMDkvZGVtbzEwMDkudnVl"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <!-- 导航输入区域 -->\n    <view class=\"nav-container\">\n      <view class=\"input-group\">\n        <view class=\"input-item\">\n          <text class=\"label\">起点</text>\n          <input \n            v-model=\"startPoint.name\" \n            class=\"input\" \n            placeholder=\"请输入起点位置\" \n            placeholder-class=\"placeholder\"\n          />\n          <button v-if=\"startPoint.name\" @tap=\"clearStart\" class=\"clear-btn\">清除</button>\n        </view>\n        \n        <view class=\"input-item\">\n          <text class=\"label\">终点</text>\n          <input \n            v-model=\"endPoint.name\" \n            class=\"input\" \n            placeholder=\"请输入终点位置\" \n            placeholder-class=\"placeholder\"\n            @confirm=\"openRoutePlan\"\n          />\n          <button v-if=\"endPoint.name\" @tap=\"clearEnd\" class=\"clear-btn\">清除</button>\n        </view>\n      </view>\n      \n      <view class=\"button-group\">\n        <button @tap=\"requestLocationPermission\" class=\"location-btn\">\n          <text class=\"btn-text\">使用当前位置</text>\n        </button>\n        \n        <button @tap=\"openRoutePlan\" class=\"nav-btn\" :disabled=\"!endPoint.name\">\n          <text class=\"btn-text\">开始导航</text>\n        </button>\n      </view>\n    </view>\n    \n    <!-- 地图容器 -->\n    <map \n      class=\"map\" \n      :latitude=\"currentLocation.lat\" \n      :longitude=\"currentLocation.lng\"\n      :scale=\"scale\"\n      :markers=\"markers\"\n      show-location\n      show-compass\n    ></map>\n    \n    <!-- 权限请求弹窗 -->\n    <view v-if=\"showPermissionModal\" class=\"modal-mask\">\n      <view class=\"modal-content\">\n        <text class=\"modal-title\">位置权限请求</text>\n        <text class=\"modal-desc\">需要获取您的位置信息才能提供导航服务，请在设置中允许位置权限</text>\n        <view class=\"modal-buttons\">\n          <button @tap=\"openSetting\" class=\"modal-btn confirm\">去设置</button>\n          <button @tap=\"closePermissionModal\" class=\"modal-btn cancel\">取消</button>\n        </view>\n      </view>\n    </view>\n    \n    <!-- 提示信息 -->\n    <view v-if=\"tipMessage\" class=\"tip-message\" :class=\"tipType\">\n      <text>{{ tipMessage }}</text>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, reactive } from 'vue'\nimport { onLoad, onUnload } from '@dcloudio/uni-app'\n\n// 响应式数据\nconst startPoint = reactive({\n  name: '',\n  latitude: 0,\n  longitude: 0\n})\n\nconst endPoint = reactive({\n  name: '',\n  latitude: 0,\n  longitude: 0\n})\n\nconst currentLocation = reactive({\n  lat: 39.9042, // 默认北京坐标\n  lng: 116.4074\n})\n\nconst scale = ref(15)\nconst markers = ref([])\nconst tipMessage = ref('')\nconst tipType = ref('info') // info, success, error\nconst showPermissionModal = ref(false)\nconst hasLocationPermission = ref(false)\n\n// 页面加载\nonLoad(() => {\n  // 检查定位权限状态\n  checkLocationPermission()\n})\n\n// 检查定位权限\nconst checkLocationPermission = () => {\n  uni.getSetting({\n    success: (res) => {\n      if (res.authSetting['scope.userLocation'] === true) {\n        // 已经有定位权限\n        hasLocationPermission.value = true\n        getCurrentLocation()\n      } else if (res.authSetting['scope.userLocation'] === false) {\n        // 用户之前拒绝了定位权限\n        hasLocationPermission.value = false\n        showTip('定位权限已被拒绝，请手动授权', 'error')\n      } else {\n        // 还未询问过权限\n        hasLocationPermission.value = false\n      }\n    },\n    fail: () => {\n      hasLocationPermission.value = false\n    }\n  })\n}\n\n// 请求定位权限\nconst requestLocationPermission = () => {\n  if (hasLocationPermission.value) {\n    // 已经有权限，直接获取位置\n    getCurrentLocation()\n    return\n  }\n  \n  // 请求定位权限\n  uni.authorize({\n    scope: 'scope.userLocation',\n    success: () => {\n      // 授权成功\n      hasLocationPermission.value = true\n      getCurrentLocation()\n      showTip('定位权限授权成功', 'success')\n    },\n    fail: (err) => {\n      console.error('授权失败:', err)\n      // 授权失败，显示权限请求弹窗\n      showPermissionModal.value = true\n    }\n  })\n}\n\n// 获取当前位置\nconst getCurrentLocation = () => {\n  uni.getLocation({\n    type: 'gcj02',\n    success: (res) => {\n      currentLocation.lat = res.latitude\n      currentLocation.lng = res.longitude\n      \n      // 更新地图标记\n      updateMarkers()\n      \n      showTip('当前位置获取成功', 'success')\n    },\n    fail: (err) => {\n      console.error('获取当前位置失败:', err)\n      showTip('获取当前位置失败，请检查定位权限或GPS', 'error')\n    }\n  })\n}\n\n// 使用当前位置作为起点\nconst useCurrentLocation = () => {\n  if (currentLocation.lat && currentLocation.lng) {\n    startPoint.name = '我的位置'\n    startPoint.latitude = currentLocation.lat\n    startPoint.longitude = currentLocation.lng\n    showTip('已设置当前位置为起点', 'success')\n  } else {\n    showTip('无法获取当前位置，请先授权定位权限', 'error')\n  }\n}\n\n// 打开系统设置页面\nconst openSetting = () => {\n  uni.openSetting({\n    success: (res) => {\n      if (res.authSetting['scope.userLocation'] === true) {\n        // 用户同意了定位权限\n        hasLocationPermission.value = true\n        getCurrentLocation()\n        showTip('定位权限已开启', 'success')\n      }\n      showPermissionModal.value = false\n    },\n    fail: () => {\n      showPermissionModal.value = false\n      showTip('打开设置失败', 'error')\n    }\n  })\n}\n\n// 关闭权限请求弹窗\nconst closePermissionModal = () => {\n  showPermissionModal.value = false\n}\n\n// 打开路线规划插件\nconst openRoutePlan = () => {\n  if (!endPoint.name.trim()) {\n    showTip('请输入终点位置', 'error')\n    return\n  }\n  \n  // 使用在腾讯位置服务申请的key\n  const key = '77NBZ-KM2C7-RY2XI-HOQPY-RJXTT-FKB4V';\n  // 调用插件的app的名称\n  const referer = 'demo1009';\n  // 是否开启导航功能\n  const navigation = 1;\n  \n  // 终点\n  const endPointData = JSON.stringify({\n    name: endPoint.name,\n    latitude: endPoint.latitude || currentLocation.lat, // 如果没有具体坐标，使用当前位置\n    longitude: endPoint.longitude || currentLocation.lng,\n  });\n  \n  let url = `plugin://routePlan/index?key=${key}&referer=${referer}&endPoint=${endPointData}&navigation=${navigation}`;\n  \n  // 如果有起点，也传入起点\n  if (startPoint.name && startPoint.latitude && startPoint.longitude) {\n    const startPointData = JSON.stringify({\n      name: startPoint.name,\n      latitude: startPoint.latitude,\n      longitude: startPoint.longitude,\n    });\n    url += `&startPoint=${startPointData}`;\n  }\n  \n  console.log('打开路线规划:', url);\n  \n  uni.navigateTo({\n    url: url,\n    fail: (err) => {\n      console.error('打开路线规划失败:', err)\n      showTip('打开导航失败，请检查插件配置', 'error')\n    }\n  });\n}\n\n// 更新地图标记\nconst updateMarkers = () => {\n  const newMarkers = []\n  \n  // 添加起点标记\n  if (startPoint.latitude && startPoint.longitude) {\n    newMarkers.push({\n      id: 1,\n      latitude: startPoint.latitude,\n      longitude: startPoint.longitude,\n      title: startPoint.name,\n      iconPath: '/static/start.png', // 起点图标\n      width: 25,\n      height: 25\n    })\n  }\n  \n  // 添加终点标记\n  if (endPoint.latitude && endPoint.longitude) {\n    newMarkers.push({\n      id: 2,\n      latitude: endPoint.latitude,\n      longitude: endPoint.longitude,\n      title: endPoint.name,\n      iconPath: '/static/end.png', // 终点图标\n      width: 25,\n      height: 25\n    })\n  }\n  \n  // 如果没有起点和终点，添加当前位置标记\n  if (newMarkers.length === 0) {\n    newMarkers.push({\n      id: 0,\n      latitude: currentLocation.lat,\n      longitude: currentLocation.lng,\n      title: '当前位置',\n      iconPath: '/static/location.png',\n      width: 30,\n      height: 30\n    })\n  }\n  \n  markers.value = newMarkers\n}\n\n// 清除起点\nconst clearStart = () => {\n  startPoint.name = ''\n  startPoint.latitude = 0\n  startPoint.longitude = 0\n  updateMarkers()\n}\n\n// 清除终点\nconst clearEnd = () => {\n  endPoint.name = ''\n  endPoint.latitude = 0\n  endPoint.longitude = 0\n  updateMarkers()\n}\n\n// 显示提示信息\nconst showTip = (message, type = 'info') => {\n  tipMessage.value = message\n  tipType.value = type\n  \n  // 3秒后自动隐藏\n  setTimeout(() => {\n    tipMessage.value = ''\n  }, 3000)\n}\n\n// 页面卸载\nonUnload(() => {\n  // 清理工作\n})\n</script>\n\n<style lang=\"scss\" scoped>\n.container {\n  position: relative;\n  height: 100vh;\n  width: 100vw;\n}\n\n.nav-container {\n  position: absolute;\n  top: 40rpx;\n  left: 40rpx;\n  right: 40rpx;\n  z-index: 10;\n  background-color: white;\n  border-radius: 20rpx;\n  padding: 30rpx;\n  box-shadow: 0 4rpx 20rpx rgba(0, 0, 0, 0.1);\n}\n\n.input-group {\n  margin-bottom: 30rpx;\n}\n\n.input-item {\n  display: flex;\n  align-items: center;\n  margin-bottom: 20rpx;\n  position: relative;\n}\n\n.label {\n  width: 80rpx;\n  font-size: 28rpx;\n  color: #333;\n  font-weight: bold;\n}\n\n.input {\n  flex: 1;\n  height: 70rpx;\n  padding: 0 30rpx;\n  font-size: 28rpx;\n  border: 1rpx solid #ddd;\n  border-radius: 10rpx;\n  margin: 0 20rpx;\n}\n\n.placeholder {\n  color: #999;\n  font-size: 28rpx;\n}\n\n.clear-btn {\n  background-color: transparent;\n  color: #999;\n  border: none;\n  padding: 10rpx;\n  font-size: 24rpx;\n  width: auto;\n  line-height: 1;\n}\n\n.button-group {\n  display: flex;\n  justify-content: space-between;\n}\n\n.location-btn, .nav-btn {\n  flex: 1;\n  height: 80rpx;\n  border: none;\n  border-radius: 10rpx;\n  font-size: 30rpx;\n}\n\n.location-btn {\n  background-color: #f0f0f0;\n  color: #333;\n  margin-right: 20rpx;\n}\n\n.nav-btn {\n  background-color: #007AFF;\n  color: white;\n}\n\n.nav-btn:disabled {\n  background-color: #cccccc;\n  color: #666666;\n}\n\n.btn-text {\n  line-height: 80rpx;\n}\n\n.map {\n  height: 100%;\n  width: 100%;\n}\n\n/* 权限请求弹窗样式 */\n.modal-mask {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: rgba(0, 0, 0, 0.5);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 100;\n}\n\n.modal-content {\n  background-color: white;\n  width: 600rpx;\n  border-radius: 20rpx;\n  padding: 40rpx;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n}\n\n.modal-title {\n  font-size: 36rpx;\n  font-weight: bold;\n  margin-bottom: 20rpx;\n  color: #333;\n}\n\n.modal-desc {\n  font-size: 28rpx;\n  color: #666;\n  text-align: center;\n  margin-bottom: 40rpx;\n  line-height: 1.5;\n}\n\n.modal-buttons {\n  display: flex;\n  width: 100%;\n  justify-content: space-between;\n}\n\n.modal-btn {\n  flex: 1;\n  height: 80rpx;\n  border: none;\n  border-radius: 10rpx;\n  font-size: 30rpx;\n  margin: 0 10rpx;\n}\n\n.modal-btn.confirm {\n  background-color: #007AFF;\n  color: white;\n}\n\n.modal-btn.cancel {\n  background-color: #f0f0f0;\n  color: #333;\n}\n\n.tip-message {\n  position: absolute;\n  top: 300rpx;\n  left: 50rpx;\n  right: 50rpx;\n  padding: 20rpx 30rpx;\n  border-radius: 10rpx;\n  text-align: center;\n  z-index: 10;\n  font-size: 28rpx;\n}\n\n.tip-message.info {\n  background-color: rgba(0, 122, 255, 0.9);\n  color: white;\n}\n\n.tip-message.success {\n  background-color: rgba(52, 199, 89, 0.9);\n  color: white;\n}\n\n.tip-message.error {\n  background-color: rgba(255, 59, 48, 0.9);\n  color: white;\n}\n</style>","import MiniProgramPage from 'D:/uni-app/uniCloudDemo0717/pages/demo1009/demo1009.vue'\nwx.createPage(MiniProgramPage)"],"names":["reactive","ref","onLoad","uni","onUnload"],"mappings":"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"}