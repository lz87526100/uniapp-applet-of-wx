{"version":3,"names":["db","common_vendor","tr","database","queryParams","ref","pageNum","pageSize","total","noData","userList","keyword","onConfirm","value","getData","_ref","_asyncToGenerator2","_regeneratorRuntime2","mark","_callee","current","res","wrap","_callee$","_context","prev","next","collection","where","concat","RegExp","orderBy","skip","limit","field","get","getCount","sent","index","hideLoading","result","errCode","_toConsumableArray2","data","count","length","showToast","title","errMsg","icon","__f__","stop","apply","arguments","goDetail","e","navigateTo","url","onReachBottom","showLoading","wx","createPage","MiniProgramPage"],"sources":["list.vue","E:/movie/HBuilderX.4.57.2025032507/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvZGVtbzA3MTkvbGlzdC52dWU"],"sourcesContent":["<template>\n  <view class=\"layout\">\r\n      <view class=\"head\">\r\n          共{{queryParams.total}}条数据，已获取{{userList.length}}条数据\r\n      </view>\r\n      \r\n      <input @confirm=\"onConfirm\" type=\"text\" class=\"search\" v-model=\"keyword\" placeholder=\"请输入数据\"/>\r\n      \r\n      <view class=\"box\" v-for=\" item,index in userList \" :key=\"item._id\" @click=\"goDetail(item._id)\">\r\n        <view>序列号：{{index+1}}</view>\r\n        <view>ID：{{item._id}}</view>\r\n        <image v-if=\"item.avatar\" :src=\"item.avatar[0].url\" mode=\"widthFix\"></image>\r\n        <view>姓名：{{item.name}}</view>\r\n        <view>年龄：{{item.age}}</view>\r\n        <view>性别：{{item.genger}}</view>\r\n        <view>创建时间：{{item.createTime}}</view>\r\n      </view>\r\n  </view>\n</template> \n\n<script setup>\nimport { ref } from 'vue';\r\nimport { onReachBottom } from \"@dcloudio/uni-app\"\n\r\n    \nconst db = uniCloud.database(); \r\nconst queryParams = ref({\r\n    pageNum:1,\r\n    pageSize:8,\r\n    total:0\r\n})\r\n\r\nconst noData = ref(false);\r\nconst userList = ref([]);\r\n\r\n\r\n//输入框中的双向绑定\r\nconst keyword = ref(\"\");\r\n\r\nconst onConfirm = ()=>{\r\n    // //正则匹配\r\n    // res = console.log( new RegExp(keyword.value , 'i').test(\"abcdefg\"));\r\n    userList.value = [];\r\n    getData();\r\n}\r\n\r\nconst getData = async ()=>{\r\n    \r\n    let current = queryParams.value.pageSize * (queryParams.value.pageNum-1)\r\n    let res = await db.collection(\"demo-user\")\r\n    //利用正则表达式实现模糊查询\r\n    .where(`${new RegExp(keyword.value,'i')}.test(name)`)\r\n    // 排序 asc  升序 desc 降序\r\n    .orderBy(\"createTime desc\")\r\n    .skip(current)\r\n    .limit(queryParams.value.pageSize)\r\n    //过滤不需要的内容 节省流量开支\r\n    .field(\"name,age,createtime,avatar\")\r\n    .get({\r\n        getCount:true\r\n    });\r\n    \r\n    //获取完数据关闭loading\r\n    uni.hideLoading();\r\n    \r\n    //没有错误且errCode为0时\r\n    if(res.result.errCode === 0){\r\n        //内容拼接\r\n        userList.value = [...userList.value,...res.result.data] ;\r\n        //将res中的总数count赋值给total\r\n        queryParams.value.total = res.result.count;\r\n        //剩余页数不足时将noData变为true\r\n        if(queryParams.value.pageSize > res.result.data.length) {\r\n            noData.value= true;\r\n        }\r\n    }else{\r\n        uni.showToast({\r\n            title:res.result.errMsg,\r\n            icon:'none' \r\n        })\r\n    }\r\n    console.log(res);\r\n}\r\n\r\nconst goDetail = (e)=>{\r\n    console.log(e);\r\n    uni.navigateTo({\r\n        url:\"/pages/demo0719/detail?id=\"+e\r\n    })\r\n}\r\n\r\n//触底翻页\r\nonReachBottom(()=>{\r\n    //当noData为真时归零\r\n    if(noData.value) {\r\n        uni.showToast({\r\n            title:'到底了！！',\r\n            icon:'none'\r\n        })\r\n        uni.hideLoading();\r\n    return\r\n    };\r\n    uni.showLoading({\r\n        title:'加载中'\r\n    })\r\n    queryParams.value.pageNum++;\r\n   \r\n    getData();\r\n})\r\n\r\ngetData(); \r\n\n</script>\n\n<style lang=\"scss\" scoped>\n.layout{\r\n    .head{\r\n        text-align: center;\r\n        padding: 10rpx 0;\r\n        font-size: 26rpx;\r\n        color: #888;\r\n    }\r\n    .search{\r\n        margin: 30rpx 0;\r\n        border: 1px solid #eee;\r\n        padding: 0 20rpx;\r\n        height: 70rpx;\r\n    }\r\n    // min-height: 100vh; // 关键：确保页面可滚动\r\n    .box{\r\n        padding: 15rpx 30rpx;\r\n        border-bottom: 1px solid #eee;\r\n    }\r\n}\n</style>\n ","import MiniProgramPage from 'D:/uni-app/uniCloudDemo0717/pages/demo0719/list.vue'\nwx.createPage(MiniProgramPage)"],"mappings":"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","ignoreList":[]}