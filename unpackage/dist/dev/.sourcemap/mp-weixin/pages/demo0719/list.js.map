{"version":3,"file":"list.js","sources":["pages/demo0719/list.vue","E:/movie/HBuilderX.4.57.2025032507/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvZGVtbzA3MTkvbGlzdC52dWU"],"sourcesContent":["<template>\n  <view class=\"layout\">\r\n      <view class=\"head\">\r\n          共{{queryParams.total}}条数据，已获取{{userList.length}}条数据\r\n      </view>\r\n      \r\n      <input @confirm=\"onConfirm\" type=\"text\" class=\"search\" v-model=\"keyword\" placeholder=\"请输入数据\"/>\r\n      \r\n      <view class=\"box\" v-for=\" item,index in userList \" :key=\"item._id\" @click=\"goDetail(item._id)\">\r\n        <view>序列号：{{index+1}}</view>\r\n        <view>ID：{{item._id}}</view>\r\n        <image v-if=\"item.avatar\" :src=\"item.avatar[0].url\" mode=\"widthFix\"></image>\r\n        <view>姓名：{{item.name}}</view>\r\n        <view>年龄：{{item.age}}</view>\r\n        <view>性别：{{item.genger}}</view>\r\n        <view>创建时间：{{item.createTime}}</view>\r\n      </view>\r\n  </view>\n</template> \n\n<script setup>\nimport { ref } from 'vue';\r\nimport { onReachBottom } from \"@dcloudio/uni-app\"\n\r\n    \nconst db = uniCloud.database(); \r\nconst queryParams = ref({\r\n    pageNum:1,\r\n    pageSize:8,\r\n    total:0\r\n})\r\n\r\nconst noData = ref(false);\r\nconst userList = ref([]);\r\n\r\n\r\n//输入框中的双向绑定\r\nconst keyword = ref(\"\");\r\n\r\nconst onConfirm = ()=>{\r\n    // //正则匹配\r\n    // res = console.log( new RegExp(keyword.value , 'i').test(\"abcdefg\"));\r\n    userList.value = [];\r\n    getData();\r\n}\r\n\r\nconst getData = async ()=>{\r\n    \r\n    let current = queryParams.value.pageSize * (queryParams.value.pageNum-1)\r\n    let res = await db.collection(\"demo-user\")\r\n    //利用正则表达式实现模糊查询\r\n    .where(`${new RegExp(keyword.value,'i')}.test(name)`)\r\n    // 排序 asc  升序 desc 降序\r\n    .orderBy(\"createTime desc\")\r\n    .skip(current)\r\n    .limit(queryParams.value.pageSize)\r\n    //过滤不需要的内容 节省流量开支\r\n    .field(\"name,age,createtime,avatar\")\r\n    .get({\r\n        getCount:true\r\n    });\r\n    \r\n    //获取完数据关闭loading\r\n    uni.hideLoading();\r\n    \r\n    //没有错误且errCode为0时\r\n    if(res.result.errCode === 0){\r\n        //内容拼接\r\n        userList.value = [...userList.value,...res.result.data] ;\r\n        //将res中的总数count赋值给total\r\n        queryParams.value.total = res.result.count;\r\n        //剩余页数不足时将noData变为true\r\n        if(queryParams.value.pageSize > res.result.data.length) {\r\n            noData.value= true;\r\n        }\r\n    }else{\r\n        uni.showToast({\r\n            title:res.result.errMsg,\r\n            icon:'none' \r\n        })\r\n    }\r\n    console.log(res);\r\n}\r\n\r\nconst goDetail = (e)=>{\r\n    console.log(e);\r\n    uni.navigateTo({\r\n        url:\"/pages/demo0719/detail?id=\"+e\r\n    })\r\n}\r\n\r\n//触底翻页\r\nonReachBottom(()=>{\r\n    //当noData为真时归零\r\n    if(noData.value) {\r\n        uni.showToast({\r\n            title:'到底了！！',\r\n            icon:'none'\r\n        })\r\n        uni.hideLoading();\r\n    return\r\n    };\r\n    uni.showLoading({\r\n        title:'加载中'\r\n    })\r\n    queryParams.value.pageNum++;\r\n   \r\n    getData();\r\n})\r\n\r\ngetData(); \r\n\n</script>\n\n<style lang=\"scss\" scoped>\n.layout{\r\n    .head{\r\n        text-align: center;\r\n        padding: 10rpx 0;\r\n        font-size: 26rpx;\r\n        color: #888;\r\n    }\r\n    .search{\r\n        margin: 30rpx 0;\r\n        border: 1px solid #eee;\r\n        padding: 0 20rpx;\r\n        height: 70rpx;\r\n    }\r\n    // min-height: 100vh; // 关键：确保页面可滚动\r\n    .box{\r\n        padding: 15rpx 30rpx;\r\n        border-bottom: 1px solid #eee;\r\n    }\r\n}\n</style>\n ","import MiniProgramPage from 'D:/uni-app/uniCloudDemo0717/pages/demo0719/list.vue'\nwx.createPage(MiniProgramPage)"],"names":["uniCloud","ref","uni","onReachBottom"],"mappings":";;;;;AAyBA,UAAM,KAAKA,cAAAA,GAAS;AACpB,UAAM,cAAcC,cAAAA,IAAI;AAAA,MACpB,SAAQ;AAAA,MACR,UAAS;AAAA,MACT,OAAM;AAAA,IACV,CAAC;AAED,UAAM,SAASA,cAAAA,IAAI,KAAK;AACxB,UAAM,WAAWA,cAAAA,IAAI,CAAA,CAAE;AAIvB,UAAM,UAAUA,cAAAA,IAAI,EAAE;AAEtB,UAAM,YAAY,MAAI;AAGlB,eAAS,QAAQ;AACjB;IACJ;AAEA,UAAM,UAAU,YAAU;AAEtB,UAAI,UAAU,YAAY,MAAM,YAAY,YAAY,MAAM,UAAQ;AACtE,UAAI,MAAM,MAAM,GAAG,WAAW,WAAW,EAExC,MAAM,GAAG,IAAI,OAAO,QAAQ,OAAM,GAAG,CAAC,aAAa,EAEnD,QAAQ,iBAAiB,EACzB,KAAK,OAAO,EACZ,MAAM,YAAY,MAAM,QAAQ,EAEhC,MAAM,4BAA4B,EAClC,IAAI;AAAA,QACD,UAAS;AAAA,MACjB,CAAK;AAGDC,oBAAG,MAAC,YAAW;AAGf,UAAG,IAAI,OAAO,YAAY,GAAE;AAExB,iBAAS,QAAQ,CAAC,GAAG,SAAS,OAAM,GAAG,IAAI,OAAO,IAAI;AAEtD,oBAAY,MAAM,QAAQ,IAAI,OAAO;AAErC,YAAG,YAAY,MAAM,WAAW,IAAI,OAAO,KAAK,QAAQ;AACpD,iBAAO,QAAO;AAAA,QACjB;AAAA,MACT,OAAS;AACDA,sBAAAA,MAAI,UAAU;AAAA,UACV,OAAM,IAAI,OAAO;AAAA,UACjB,MAAK;AAAA,QACjB,CAAS;AAAA,MACJ;AACDA,oBAAAA,MAAA,MAAA,OAAA,iCAAY,GAAG;AAAA,IACnB;AAEA,UAAM,WAAW,CAAC,MAAI;AAClBA,oBAAAA,oDAAY,CAAC;AACbA,oBAAAA,MAAI,WAAW;AAAA,QACX,KAAI,+BAA6B;AAAA,MACzC,CAAK;AAAA,IACL;AAGAC,kBAAAA,cAAc,MAAI;AAEd,UAAG,OAAO,OAAO;AACbD,sBAAAA,MAAI,UAAU;AAAA,UACV,OAAM;AAAA,UACN,MAAK;AAAA,QACjB,CAAS;AACDA,sBAAG,MAAC,YAAW;AACnB;AAAA,MACJ;AACIA,oBAAAA,MAAI,YAAY;AAAA,QACZ,OAAM;AAAA,MACd,CAAK;AACD,kBAAY,MAAM;AAElB;IACJ,CAAC;AAED;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC7GA,GAAG,WAAW,eAAe;"}