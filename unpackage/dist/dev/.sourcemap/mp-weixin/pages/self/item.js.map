{"version":3,"file":"item.js","sources":["pages/self/item.vue","E:/movie/HBuilderX.4.57.2025032507/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc2VsZi9pdGVtLnZ1ZQ"],"sourcesContent":["<template>\n    <view class=\"comments-page\">\n        <!-- È°µÈù¢Ê†áÈ¢ò -->\n        <view class=\"page-header\">\n            <text class=\"page-title\">ÊàëÁöÑËØÑËÆ∫</text>\n            <text class=\"page-subtitle\" v-if=\"currentUserId\">Áî®Êà∑ID: {{ currentUserId }}</text>\n        </view>\n        \n        <!-- ËØÑËÆ∫ÂàóË°® -->\n        <view \n            v-for=\"item in commentList\" \n            :key=\"item._id\" \n            class=\"comment-item\"\n            @click=\"goToDetail(item)\"\n        >\n            <view class=\"comment-card\">\n                <!-- ÂÜÖÂÆπÂ±ïÁ§∫ -->\n                <view class=\"comment-content\">\n                    <text class=\"comment-text\">{{ item.content }}</text>\n                </view>\n                \n                <!-- ÂõæÁâáÂ±ïÁ§∫ -->\n                <view class=\"comment-images\" v-if=\"item.pics && item.pics.length > 0\">\n                    <view class=\"images-grid\">\n                        <image \n                            v-for=\"(pic, index) in item.pics\" \n                            :key=\"index\" \n                            :src=\"pic\" \n                            mode=\"aspectFill\"\n                            class=\"comment-image\"\n                            @click.stop=\"previewImage(item.pics, index)\"\n                        ></image>\n                    </view>\n                </view>\n                \n                <!-- Â∫ïÈÉ®‰ø°ÊÅØ -->\n                <view class=\"comment-footer\">\n                    <text class=\"comment-time\">{{ formatTime(item.createTime) }}</text>\n                    <view class=\"comment-stats\">\n                        <text class=\"stat-item\">‚ù§Ô∏è {{ item.like_count || 0 }}</text>\n                        <text class=\"stat-item\">üí¨ {{ item.comment_count || 0 }}</text>\n                    </view>\n                </view>\n            </view>\n        </view>\n        \n        <!-- Á©∫Áä∂ÊÄÅ -->\n        <view class=\"no-data\" v-if=\"commentList.length === 0 && !loading\">\n            <text class=\"no-data-text\">ÊöÇÊó†ËØÑËÆ∫ÂÜÖÂÆπ</text>\n            <text class=\"tip\">ÊÇ®ËøòÊ≤°ÊúâÂèëË°®Ëøá‰ªª‰ΩïÂÜÖÂÆπ</text>\n        </view>\n        \n        <!-- Âä†ËΩΩÁä∂ÊÄÅ -->\n        <view class=\"loading\" v-if=\"loading\">\n            <text>Âä†ËΩΩ‰∏≠...</text>\n        </view>\n    </view>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue'\nimport { onPullDownRefresh, onReachBottom, onLoad } from '@dcloudio/uni-app'\n\n// ÂìçÂ∫îÂºèÊï∞ÊçÆ\nconst commentList = ref([])\nconst currentUserId = ref('')\nconst loading = ref(false)\n\n// Ë∑≥ËΩ¨Âà∞ËØ¶ÊÉÖÈ°µ - Ê®°‰ªø favorites È°µÈù¢ÁöÑÂÆûÁé∞\nfunction goToDetail(item) {\n  if (!item || !item._id) {\n    uni.showToast({ title: 'ÊñáÁ´†‰ø°ÊÅØÈîôËØØ', icon: 'none' });\n    return;\n  }\n  \n  // ‰ΩøÁî®Áõ∏ÂêåÁöÑË∑ØÁî±Ê†ºÂºè\n  uni.navigateTo({\n    url: `/pages/blog/detail?id=${item._id}`\n  });\n}\n\n// ÂõæÁâáÈ¢ÑËßàÂäüËÉΩ - Ê®°‰ªø favorites È°µÈù¢ÁöÑÂÆûÁé∞\nlet previewTimer = null;\nfunction previewImage(pics, currentIndex) {\n  if (previewTimer) {\n    clearTimeout(previewTimer);\n  }\n  \n  previewTimer = setTimeout(() => {\n    if (!pics || pics.length === 0) return;\n\n    const urls = pics\n      .map(pic => {\n        if (typeof pic === 'string') {\n          return pic.trim();\n        }\n        return '';\n      })\n      .filter(url => url && typeof url === 'string');\n\n    if (urls.length === 0) return;\n\n    uni.previewImage({\n      urls,\n      current: currentIndex\n    });\n  }, 150);\n}\n\n// Êé•Êî∂È°µÈù¢ÂèÇÊï∞\nonLoad((options) => {\n    console.log('È°µÈù¢ÂèÇÊï∞:', options)\n    \n    if (options.userId) {\n        currentUserId.value = options.userId\n    } else {\n        const userInfoFromStorage = uni.getStorageSync('uni-id-pages-userInfo')\n        if (userInfoFromStorage && userInfoFromStorage._id) {\n            currentUserId.value = userInfoFromStorage._id\n        }\n    }\n    \n    console.log('ÂΩìÂâçÁî®Êà∑ID:', currentUserId.value)\n    loadData()\n})\n\n// Âä†ËΩΩÊï∞ÊçÆ\nconst loadData = async () => {\n    if (loading.value) return\n    \n    loading.value = true\n    \n    try {\n        const articlesCloudObj = uniCloud.importObject('articlesCloudObj')\n        const res = await articlesCloudObj.list({\n            page: 1,\n            size: 50\n        })\n        \n        console.log('Âä†ËΩΩÊï∞ÊçÆÁªìÊûú:', res)\n        \n        if (res.errCode === 0) {\n            const data = res.data || []\n            \n            // Á≠õÈÄâÂΩìÂâçÁî®Êà∑ÁöÑÊâÄÊúâÊñáÁ´†\n            const userArticles = data.filter(item => {\n                if (Array.isArray(item.user_id)) {\n                    // Ê£ÄÊü•Êï∞ÁªÑ‰∏≠ÁöÑÊØè‰∏™ÂØπË±°ÁöÑ _id ÊòØÂê¶ÂåπÈÖçÂΩìÂâçÁî®Êà∑ID\n                    return item.user_id.some(user => user._id === currentUserId.value)\n                } else {\n                    return item.user_id === currentUserId.value\n                }\n            })\n            \n            console.log(`ÊÄªÊñáÁ´†Êï∞: ${data.length}, Áî®Êà∑ÊñáÁ´†Êï∞: ${userArticles.length}`)\n            console.log('Áî®Êà∑ÊñáÁ´†:', userArticles)\n            \n            // Â§ÑÁêÜÊï∞ÊçÆ\n            commentList.value = userArticles.map(item => ({\n                _id: item._id || '',\n                content: item.content || 'ÊöÇÊó†ÂÜÖÂÆπ',\n                pics: processImagePaths(item.pics),\n                like_count: item.like_count || 0,\n                comment_count: item.comment_count || 0,\n                createTime: item.createTime || item.publish_date || Date.now()\n            }))\n            \n        } else {\n            uni.showToast({\n                title: 'Âä†ËΩΩÂ§±Ë¥•',\n                icon: 'none'\n            })\n        }\n    } catch (error) {\n        console.error('Âä†ËΩΩÊï∞ÊçÆÂºÇÂ∏∏:', error)\n        uni.showToast({\n            title: 'Âä†ËΩΩÂ§±Ë¥•',\n            icon: 'none'\n        })\n    } finally {\n        loading.value = false\n    }\n}\n\n// Â§ÑÁêÜÂõæÁâáË∑ØÂæÑ\nconst processImagePaths = (pics) => {\n    if (!Array.isArray(pics)) {\n        return []\n    }\n    \n    return pics.map(pic => {\n        if (!pic) return ''\n        if (typeof pic === 'object') {\n            return pic.url || pic.path || pic.src || ''\n        }\n        return String(pic)\n    }).filter(pic => pic)\n}\n\n// Ê†ºÂºèÂåñÊó∂Èó¥\nconst formatTime = (timestamp) => {\n    if (!timestamp) return ''\n    const date = new Date(timestamp)\n    return `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`\n}\n\n// ‰∏ãÊãâÂà∑Êñ∞\nonPullDownRefresh(() => {\n    loadData().finally(() => {\n        uni.stopPullDownRefresh()\n    })\n})\n</script>\n\n<style lang=\"scss\" scoped>\n.comments-page {\n    padding: 20rpx;\n    background: #f5f5f5;\n    min-height: 100vh;\n}\n\n.page-header {\n    padding: 30rpx;\n    background: white;\n    border-radius: 16rpx;\n    margin-bottom: 20rpx;\n    text-align: center;\n    \n    .page-title {\n        display: block;\n        font-size: 36rpx;\n        font-weight: bold;\n        color: #333;\n        margin-bottom: 10rpx;\n    }\n    \n    .page-subtitle {\n        display: block;\n        font-size: 24rpx;\n        color: #999;\n    }\n}\n\n.comment-item {\n    margin-bottom: 20rpx;\n    transition: all 0.2s ease;\n    \n    &:active {\n        transform: scale(0.99);\n        opacity: 0.8;\n    }\n}\n\n.comment-card {\n    background: white;\n    border-radius: 16rpx;\n    padding: 30rpx;\n    box-shadow: 0 4rpx 20rpx rgba(0,0,0,0.06);\n}\n\n.comment-content {\n    margin-bottom: 20rpx;\n    \n    .comment-text {\n        font-size: 32rpx;\n        color: #333;\n        line-height: 1.6;\n        display: block;\n    }\n}\n\n.comment-images {\n    margin-bottom: 20rpx;\n    \n    .images-grid {\n        display: grid;\n        grid-template-columns: repeat(3, 1fr);\n        gap: 10rpx;\n    }\n    \n    .comment-image {\n        width: 100%;\n        height: 200rpx;\n        border-radius: 12rpx;\n        transition: all 0.2s ease;\n        \n        &:active {\n            transform: scale(0.95);\n        }\n    }\n}\n\n.comment-footer {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    \n    .comment-time {\n        font-size: 24rpx;\n        color: #999;\n    }\n    \n    .comment-stats {\n        display: flex;\n        gap: 20rpx;\n        \n        .stat-item {\n            font-size: 24rpx;\n            color: #666;\n        }\n    }\n}\n\n.loading {\n    text-align: center;\n    padding: 40rpx;\n    color: #999;\n    font-size: 28rpx;\n}\n\n.no-data {\n    text-align: center;\n    padding: 120rpx 30rpx;\n    \n    .no-data-text {\n        display: block;\n        font-size: 32rpx;\n        color: #999;\n        margin-bottom: 20rpx;\n    }\n    \n    .tip {\n        display: block;\n        font-size: 28rpx;\n        color: #ccc;\n    }\n}\n</style>","import MiniProgramPage from 'D:/uni-app/uniCloudDemo0717/pages/self/item.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","onLoad","uniCloud","onPullDownRefresh"],"mappings":"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"}