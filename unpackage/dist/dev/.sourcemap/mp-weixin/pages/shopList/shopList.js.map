{"version":3,"file":"shopList.js","sources":["pages/shopList/shopList.vue","E:/movie/HBuilderX.4.57.2025032507/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc2hvcExpc3Qvc2hvcExpc3QudnVl"],"sourcesContent":["<template>\n  <view class=\"shop-list\" :aria-label=\"'Á≤æÈÄâÂïÜÂÆ∂ÂàóË°®'\">\n    \n    <view class=\"head\">\n      <store-head></store-head>\n    </view>\n\n    <!-- ÂÜÖÂÆπÂå∫ -->\n    <view class=\"body\">\n      <scroll-view\n        scroll-y \n        class=\"content\" \n        @scrolltolower=\"loadMore\"\n        enable-back-to-top\n      >\n        <!-- È™®Êû∂Â±è -->\n        <view v-if=\"loading && shopsList.length === 0\" class=\"skeleton\">\n          <view v-for=\"i in 5\" :key=\"i\" class=\"skeleton-item\">\n            <view class=\"skeleton-img\"></view>\n            <view class=\"skeleton-body\">\n              <view class=\"skeleton-line w-70\"></view>\n              <view class=\"skeleton-line w-90 mt-8\"></view>\n              <view class=\"skeleton-line w-60 mt-8\"></view>\n            </view>\n          </view>\n        </view>\n\n        <!-- Â∫óÈì∫ÂàóË°® -->\n        <view v-else class=\"shop-list-content\">\n          <view \n            class=\"shop-card\" \n            v-for=\"shop in shopsList\" \n            :key=\"shop._id\"\n            @click=\"goShopDetail(shop._id)\"\n            :aria-label=\"`ËøõÂÖ• ${shop.shopName} Â∫óÈì∫ËØ¶ÊÉÖ`\"\n          >\n            <image \n              class=\"shop-img fade-in\" \n              :src=\"shop.shopPic || '/static/default-shop.jpg'\" \n              mode=\"widthFix\"\n              lazy-load\n              @error=\"handleImageError\"\n            />\n            <view class=\"shop-overlay\"></view>\n            <view class=\"shop-content\">\n              <view class=\"shop-top\">\n                <text class=\"shop-name\">{{ shop.shopName }}</text>\n                <view class=\"rating-badge\" v-if=\"shop.rating > 0\">\n                  <text class=\"star-icon\">‚òÖ</text>\n                  <text class=\"rating-text\">{{ (shop.rating / 10).toFixed(1) }}</text>\n                </view>\n              </view>\n              <view class=\"shop-meta\">\n                <view class=\"meta-item address\">\n                  <text class=\"text\">{{ shop.address }}</text>\n                  <view class=\"meta-row\">\n                    <view class=\"meta-tag sales\" v-if=\"shop.monthlyOrders !== undefined\">\n                      ÊúàÂîÆ {{ shop.monthlyOrders }} Âçï\n                    </view>\n                    <view class=\"meta-tag time\" v-if=\"shop.deliveryTime\">\n                      ‚è±Ô∏è {{ shop.deliveryTime }}ÂàÜÈíü\n                    </view>\n                  </view>\n                </view>\n              </view>\n            </view>\n          </view>\n\n          <!-- Á©∫Áä∂ÊÄÅ -->\n          <view v-if=\"shopsList.length === 0 && !loading\" class=\"empty-state\">\n            <view class=\"empty-icon\">üè™</view>\n            <text class=\"empty-title\">Ê≤°ÊúâÊâæÂà∞Â∫óÈì∫</text>\n            <text class=\"empty-desc\">\n              {{ searchKeyword ? `Êú™ÊâæÂà∞\"${searchKeyword}\"Áõ∏ÂÖ≥Â∫óÈì∫` : 'ÊöÇÊó†Êé®ËçêÂïÜÂÆ∂' }}\n            </text>\n            <button class=\"empty-btn\" @click=\"loadShops(1)\">Âà∑Êñ∞ÈáçËØï</button>\n          </view>\n\n          <!-- Âä†ËΩΩÊõ¥Â§ö -->\n          <view v-if=\"shopsList.length > 0\" class=\"load-more\">\n            <uni-load-more \n              :status=\"loadingMore ? 'loading' : (hasMore ? 'more' : 'noMore')\"\n              iconType=\"auto\"\n            />\n          </view>\n        </view>\n      </scroll-view>\n    </view>\n\n    <!-- ‰øÆÂ§çÔºöÂú∞ÂõæÊÇ¨ÊµÆÊåâÈíÆ -->\n    <view class=\"fab-map\" @click=\"goToMap\">\n      <view class=\"map-icon\">üìç</view>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue';\n\nconst shopsList = ref([]);\nconst loading = ref(false);\nconst loadingMore = ref(false);\nconst searchKeyword = ref('');\nconst hasMore = ref(true);\nconst currentPage = ref(1);\n\nonMounted(() => {\n  loadShops(1);\n});\n\n// Ë∑≥ËΩ¨Âà∞Âú∞ÂõæÈ°µÈù¢\nfunction goToMap() {\n  console.log('Ë∑≥ËΩ¨Âà∞Âú∞ÂõæÈ°µÈù¢');\n  uni.navigateTo({\n    url: '/pages/showMap/showMap'\n  });\n}\n\nasync function loadShops(page = 1) {\n  if (loading.value || loadingMore.value) return;\n\n  if (page === 1) {\n    loading.value = true;\n    shopsList.value = [];\n    hasMore.value = true;\n    currentPage.value = 1;\n  } else {\n    loadingMore.value = true;\n  }\n\n  try {\n    const res = await uniCloud.callFunction({\n      name: 'getShopList',\n      data: {\n        keyword: searchKeyword.value,\n        page: page,\n        pageSize: 10\n      }\n    });\n\n    if (res.result?.errCode === 0) {\n      const newData = res.result.data || [];\n      \n      // ËΩ¨Êç¢Êï∞ÊçÆÁªìÊûÑÔºåÈÄÇÈÖçÂâçÁ´ØÊòæÁ§∫\n      const formattedData = newData.map(shop => ({\n        _id: shop.id,  // ‰ΩøÁî®ËΩ¨Êç¢ÂêéÁöÑid\n        shopName: shop.name,\n        shopPic: shop.shopPic,\n        address: shop.address,\n        rating: parseFloat(shop.rating) * 10, // ËΩ¨ÂõûÊï¥Êï∞Ê†ºÂºè\n        monthlyOrders: shop.monthlySales, // ‰ΩøÁî®ËΩ¨Êç¢ÂêéÁöÑÂ≠óÊÆµ\n        businessHours: shop.businessHours,\n        description: shop.description,\n        phone: shop.phone\n      }));\n      \n      if (page === 1) {\n        shopsList.value = formattedData;\n      } else {\n        shopsList.value.push(...formattedData);\n      }\n\n      hasMore.value = newData.length === 10;\n      currentPage.value = page;\n    } else {\n      uni.showToast({ title: res.result?.errMsg || 'Âä†ËΩΩÂ§±Ë¥•', icon: 'none' });\n    }\n  } catch (e) {\n    console.error('Âä†ËΩΩÂ∫óÈì∫Â§±Ë¥•:', e);\n    uni.showToast({ title: 'ÁΩëÁªúÈîôËØØ', icon: 'none' });\n  } finally {\n    loading.value = false;\n    loadingMore.value = false;\n  }\n}\n\nfunction loadMore() {\n  if (hasMore.value && !loadingMore.value) {\n    loadShops(currentPage.value + 1);\n  }\n}\n\nfunction clearSearch() {\n  searchKeyword.value = '';\n  loadShops(1);\n}\n\nfunction handleImageError(e) {\n  e.target.src = '/static/default-shop.jpg';\n}\n\nfunction goShopDetail(id) {\n  if (!id) return;\n  uni.navigateTo({ \n    url: `/pages/shopList/shopDetail?id=${encodeURIComponent(id)}` \n  });\n}\n</script>\n\n<style lang=\"scss\" scoped>\n/* -------------------- ÂèòÈáèÂå∫ -------------------- */\n$primary: #4F8BFF;\n$secondary: #4A6CF7;\n$text: #2d3748;\n$light-text: #718096;\n$radius: 32rpx;\n$shadow: 0 8rpx 32rpx rgba(0, 0, 0, .08);\n$transition: all .3s cubic-bezier(.4, 0, .2, 1);\n\n/* -------------------- ‰∏ªÁªìÊûÑ -------------------- */\n.shop-list {\n  min-height: 100vh;\n  background: linear-gradient(180deg, #CDE5FF 0%, #E9F3FF 100%);\n  display: flex;\n  flex-direction: column;\n  padding-bottom: constant(safe-area-inset-bottom);\n  padding-bottom: env(safe-area-inset-bottom);\n}\n\n/* Â§¥ÈÉ®ÔºöÊØõÁéªÁíÉ */\n.head {\n  position: sticky;\n  top: 0;\n  z-index: 9;\n  backdrop-filter: blur(20rpx);\n  -webkit-backdrop-filter: blur(20rpx);\n  background: rgba(255, 255, 255, .65);\n  box-shadow: 0 2rpx 16rpx rgba(0, 0, 0, .05);\n}\n\n/* ÂÜÖÂÆπÂå∫ */\n.body {\n  flex: 1;\n  background-color: rgba(255, 255, 255, .65);\n  border-radius: $radius $radius 0 0;\n  overflow: hidden;\n  margin-top: -16rpx;\n}\n\n.content {\n  height: 100%;\n  background: transparent;\n  padding: 24rpx 0rpx 40rpx;\n}\n\n/* -------------------- ‰øÆÂ§çÔºöÂú∞ÂõæÊÇ¨ÊµÆÊåâÈíÆÊ†∑Âºè -------------------- */\n.fab-map {\n  position: fixed;\n  right: 50rpx;\n  bottom: 140rpx;\n  z-index: 999;\n  width: 105rpx;\n  height: 105rpx;\n  background: linear-gradient(135deg, #4F8BFF 0%, #6AA6FF 100%);\n  border-radius: 50%;\n  box-shadow: 0 8rpx 32rpx rgba(79, 139, 255, 0.45);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  animation: fadeInUp 0.6s ease both;\n  \n  &:active {\n    transform: scale(0.9);\n    box-shadow: 0 4rpx 16rpx rgba(79, 139, 255, 0.6);\n  }\n  \n  .map-icon {\n    font-size: 32rpx;\n    color: white;\n    font-weight: 300;\n  }\n}\n\n@keyframes fadeInUp {\n  from {\n    opacity: 0;\n    transform: translateY(40rpx) scale(0.8);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0) scale(1);\n  }\n}\n\n/* -------------------- È™®Êû∂Â±è -------------------- */\n.skeleton {\n  .skeleton-item {\n    background: white;\n    border-radius: 24rpx;\n    margin: 0 24rpx 24rpx;\n    overflow: hidden;\n    box-shadow: 0 8rpx 24rpx rgba(0, 0, 0, 0.06);\n    \n    .skeleton-img {\n      width: 100%;\n      height: 300rpx;\n      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);\n      background-size: 200% 100%;\n      animation: wave 1.8s infinite;\n    }\n    \n    .skeleton-body {\n      padding: 28rpx;\n    }\n    \n    .skeleton-line {\n      height: 26rpx;\n      border-radius: 12rpx;\n      background: linear-gradient(90deg, #f5f5f5 25%, #eaeaea 50%, #f5f5f5 75%);\n      background-size: 200% 100%;\n      animation: wave 1.8s infinite;\n    }\n    \n    .w-70 { width: 70%; }\n    .w-90 { width: 90%; }\n    .w-60 { width: 60%; }\n    .mt-8 { margin-top: 8rpx; }\n  }\n}\n\n@keyframes wave {\n  0% { background-position: -200% 0; }\n  100% { background-position: 200% 0; }\n}\n\n/* -------------------- Â∫óÈì∫Âç°Áâá -------------------- */\n.shop-list-content {\n  padding: 0 24rpx;\n}\n\n.shop-card {\n  position: relative;\n  background: white;\n  border-radius: 24rpx;\n  margin-bottom: 24rpx;\n  overflow: hidden;\n  box-shadow: 0 8rpx 32rpx rgba(0, 0, 0, .08);\n  transition: all .3s cubic-bezier(.4, 0, .2, 1);\n  \n  &:active {\n    transform: scale(.98);\n    box-shadow: 0 4rpx 16rpx rgba(0, 0, 0, .12);\n  }\n\n  .shop-img {\n    width: 100%;\n    height: auto;\n    max-height: 400rpx;\n    object-fit: cover;\n    opacity: 0;\n    transition: opacity 0.4s ease;\n    \n    &.fade-in {\n      opacity: 1;\n    }\n  }\n\n  .shop-overlay {\n    position: absolute;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    height: 160rpx;\n    background: linear-gradient(to top, rgba(0, 0, 0, 0.85), transparent);\n    z-index: 1;\n  }\n\n  .shop-content {\n    position: absolute;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    padding: 28rpx;\n    color: white;\n    z-index: 2;\n    pointer-events: none;\n\n    .shop-top {\n      display: flex;\n      justify-content: space-between;\n      align-items: flex-start;\n      margin-bottom: 16rpx;\n\n      .shop-name {\n        font-size: 32rpx;\n        font-weight: 700;\n        max-width: 70%;\n        line-height: 1.3;\n        overflow: hidden;\n        display: -webkit-box;\n        -webkit-line-clamp: 1;\n        -webkit-box-orient: vertical;\n        text-shadow: 0 1px 3px rgba(0,0,0,0.8);\n      }\n\n      .rating-badge {\n        display: flex;\n        align-items: center;\n        background: rgba(255, 255, 255, 0.2);\n        backdrop-filter: blur(8rpx);\n        padding: 6rpx 14rpx;\n        border-radius: 20rpx;\n        font-weight: bold;\n        font-size: 24rpx;\n        \n        .star-icon {\n          font-size: 20rpx;\n          margin-right: 4rpx;\n        }\n      }\n    }\n\n    .shop-meta {\n      .address {\n        display: flex;\n        align-items: flex-start;\n        font-size: 24rpx;\n        opacity: 0.9;\n        \n        .text {\n          flex: 1;\n          line-height: 1.4;\n          display: -webkit-box;\n          -webkit-line-clamp: 1;\n          -webkit-box-orient: vertical;\n          overflow: hidden;\n        }\n      }\n\n      .meta-row {\n        display: flex;\n        gap: 16rpx;\n        flex-wrap: wrap;\n      }\n\n      .meta-tag {\n        font-size: 20rpx;\n        background: rgba(255, 255, 255, 0.15);\n        padding: 4rpx 12rpx;\n        border-radius: 12rpx;\n        backdrop-filter: blur(4rpx);\n        white-space: nowrap;\n        \n        &.sales { color: #FFD700; }\n        &.time { color: #4ade80; }\n      }\n    }\n  }\n}\n\n/* -------------------- Á©∫Áä∂ÊÄÅ -------------------- */\n.empty-state {\n  text-align: center;\n  padding: 140rpx 40rpx 100rpx;\n  \n  .empty-icon {\n    font-size: 120rpx;\n    margin-bottom: 30rpx;\n    opacity: 0.6;\n  }\n  \n  .empty-title {\n    font-size: 34rpx;\n    font-weight: 700;\n    color: $text;\n    margin-bottom: 16rpx;\n  }\n  \n  .empty-desc {\n    font-size: 26rpx;\n    color: $light-text;\n    margin-bottom: 40rpx;\n    line-height: 1.5;\n  }\n  \n  .empty-btn {\n    background: linear-gradient(135deg, $primary, #6AA6FF);\n    color: white;\n    border: none;\n    border-radius: 50rpx;\n    padding: 18rpx 60rpx;\n    font-size: 28rpx;\n    box-shadow: 0 8rpx 20rpx rgba($primary, 0.4);\n    transition: all 0.2s;\n    \n    &:active {\n      transform: scale(0.96);\n    }\n  }\n}\n\n/* -------------------- Âä†ËΩΩÊõ¥Â§ö -------------------- */\n.load-more {\n  padding: 40rpx 0;\n  text-align: center;\n  \n  ::v-deep .uni-load-more__text {\n    font-size: 26rpx;\n    color: #8B9AB6;\n  }\n}\n\n/* -------------------- Âä®ÁîªÊïàÊûú -------------------- */\n.fade-in {\n  animation: fadeIn 0.5s ease forwards;\n}\n\n@keyframes fadeIn {\n  from { opacity: 0; }\n  to { opacity: 1; }\n}\n\n@keyframes float {\n  0%, 100% { transform: translateY(0); }\n  50% { transform: translateY(-12rpx); }\n}\n\n@keyframes titleGlow {\n  from { text-shadow: 0 0 10rpx rgba($primary, 0.3); }\n  to { text-shadow: 0 0 20rpx rgba($secondary, 0.5), 0 0 30rpx rgba($primary, 0.4); }\n}\n\n/* -------------------- ÊêúÁ¥¢Ê°Ü -------------------- */\n.search-box {\n  padding: 0 30rpx 40rpx;\n  \n  ::v-deep .uni-searchbar {\n    height: 88rpx;\n    \n    .uni-searchbar__input-box {\n      background: white !important;\n      border-radius: 50rpx !important;\n      box-shadow: 0 8rpx 24rpx rgba(0, 0, 0, 0.1);\n      padding: 0 36rpx !important;\n      \n      input {\n        font-size: 28rpx;\n        color: $text;\n      }\n    }\n  }\n}\n</style>","import MiniProgramPage from 'D:/uni-app/uniCloudDemo0717/pages/shopList/shopList.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","onMounted","uni","uniCloud"],"mappings":";;;;;;;;;;;;;;;AAmGA,UAAM,YAAYA,cAAAA,IAAI,CAAA,CAAE;AACxB,UAAM,UAAUA,cAAAA,IAAI,KAAK;AACzB,UAAM,cAAcA,cAAAA,IAAI,KAAK;AAC7B,UAAM,gBAAgBA,cAAAA,IAAI,EAAE;AAC5B,UAAM,UAAUA,cAAAA,IAAI,IAAI;AACxB,UAAM,cAAcA,cAAAA,IAAI,CAAC;AAEzBC,kBAAAA,UAAU,MAAM;AACd,gBAAU,CAAC;AAAA,IACb,CAAC;AAGD,aAAS,UAAU;AACjBC,oBAAAA,MAAA,MAAA,OAAA,sCAAY,SAAS;AACrBA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK;AAAA,MACT,CAAG;AAAA,IACH;AAEA,mBAAe,UAAU,OAAO,GAAG;;AACjC,UAAI,QAAQ,SAAS,YAAY;AAAO;AAExC,UAAI,SAAS,GAAG;AACd,gBAAQ,QAAQ;AAChB,kBAAU,QAAQ;AAClB,gBAAQ,QAAQ;AAChB,oBAAY,QAAQ;AAAA,MACxB,OAAS;AACL,oBAAY,QAAQ;AAAA,MACrB;AAED,UAAI;AACF,cAAM,MAAM,MAAMC,cAAQ,GAAC,aAAa;AAAA,UACtC,MAAM;AAAA,UACN,MAAM;AAAA,YACJ,SAAS,cAAc;AAAA,YACvB;AAAA,YACA,UAAU;AAAA,UACX;AAAA,QACP,CAAK;AAED,cAAI,SAAI,WAAJ,mBAAY,aAAY,GAAG;AAC7B,gBAAM,UAAU,IAAI,OAAO,QAAQ,CAAA;AAGnC,gBAAM,gBAAgB,QAAQ,IAAI,WAAS;AAAA,YACzC,KAAK,KAAK;AAAA;AAAA,YACV,UAAU,KAAK;AAAA,YACf,SAAS,KAAK;AAAA,YACd,SAAS,KAAK;AAAA,YACd,QAAQ,WAAW,KAAK,MAAM,IAAI;AAAA;AAAA,YAClC,eAAe,KAAK;AAAA;AAAA,YACpB,eAAe,KAAK;AAAA,YACpB,aAAa,KAAK;AAAA,YAClB,OAAO,KAAK;AAAA,UACb,EAAC;AAEF,cAAI,SAAS,GAAG;AACd,sBAAU,QAAQ;AAAA,UAC1B,OAAa;AACL,sBAAU,MAAM,KAAK,GAAG,aAAa;AAAA,UACtC;AAED,kBAAQ,QAAQ,QAAQ,WAAW;AACnC,sBAAY,QAAQ;AAAA,QAC1B,OAAW;AACLD,wBAAAA,MAAI,UAAU,EAAE,SAAO,SAAI,WAAJ,mBAAY,WAAU,QAAQ,MAAM,OAAM,CAAE;AAAA,QACpE;AAAA,MACF,SAAQ,GAAG;AACVA,sBAAc,MAAA,MAAA,SAAA,sCAAA,WAAW,CAAC;AAC1BA,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,OAAM,CAAE;AAAA,MACjD,UAAY;AACR,gBAAQ,QAAQ;AAChB,oBAAY,QAAQ;AAAA,MACrB;AAAA,IACH;AAEA,aAAS,WAAW;AAClB,UAAI,QAAQ,SAAS,CAAC,YAAY,OAAO;AACvC,kBAAU,YAAY,QAAQ,CAAC;AAAA,MAChC;AAAA,IACH;AAOA,aAAS,iBAAiB,GAAG;AAC3B,QAAE,OAAO,MAAM;AAAA,IACjB;AAEA,aAAS,aAAa,IAAI;AACxB,UAAI,CAAC;AAAI;AACTA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK,iCAAiC,mBAAmB,EAAE,CAAC;AAAA,MAChE,CAAG;AAAA,IACH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACnMA,GAAG,WAAW,eAAe;"}