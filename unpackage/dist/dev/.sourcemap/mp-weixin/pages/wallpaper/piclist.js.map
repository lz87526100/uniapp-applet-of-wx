{"version":3,"file":"piclist.js","sources":["pages/wallpaper/piclist.vue","E:/movie/HBuilderX.4.57.2025032507/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvd2FsbHBhcGVyL3BpY2xpc3QudnVl"],"sourcesContent":["<template>\n\t<view class=\"layout\">\n\t\t<view class=\"add\" @click=\"handleAdd\">\n\t\t\t<button size=\"mini\" type=\"primary\">添加</button>\n\t\t</view>\n\t\t<view class=\"list\">\n\t\t\t<!-- <view class=\"item\" v-for=\"item in 5\"> -->\n                <!-- <view class=\"item\" v-for=\"item in listData\" :key=\"item._id\"> -->\r\n                \r\n            <!-- 数据库组件 -->\r\n              <!-- v-slot 指的是插槽 存放需要显示的内容 pagination 分页属性 error 错误显示 \r\n              :page-size 为页面限制  getcount 为查询总数 onReachBottom 触底上拉起步7个-->\r\n            <unicloud-db ref=\"udb\" v-slot:default=\"{hasMore,data,pagination,loading,error,options}\" \r\n            :collection=\"colList\" :page-size=\"7\" getcount \r\n            field=\"description,createTime,classid.name as classname,picurl.url as url\">\r\n            \r\n            \r\n            <view v-if=\"error\">{{error}}</view>\r\n            <!-- 加载中显示 -->\r\n            <view v-if=\"loading\"></view>\r\n            \r\n                <view class=\"item\" v-for=\"item in data\" >\n\t\t\t\t<view class=\"left\">\n                    <!-- :src 为动态绑定  -->\n                    <image :src=\"item.url\" mode=\"aspectFill\" @click=\"preview(item.url)\"></image>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"right\">\n\t\t\t\t\t<view class=\"desc\">{{item.description}}</view>\n                    <!-- 导入dayjs输出时间 -->\n\t\t\t\t\t<view class=\"classname\">\n                    <text>\n                           {{item.classname[0]}} \n                    </text>\n                    <text>\n                        {{dayjs(item.createTime).format(\"MM-DD HH:mm\")}}\n                    </text>\n                    </view>\n\t\t\t\t</view>\n\t\t\t</view>\r\n            \r\n            <!-- 当loading图标正在加载中不出现数据触底  -->\r\n            <uni-load-more v-if=\"!hasMore && !loading\"  status=\"noMore\"></uni-load-more>\r\n            \r\n            </unicloud-db>\r\n            \r\n            \n\t\t</view>\n\t</view>\n\t\n\t\t\n\t<!-- 点击弹窗 -->\n\t<uni-popup ref=\"popup\" border-radius=\"10px 10px 0 0\" :is-mask-click=\"false\">\n\t\t<view class=\"popupOut\">\t\n            <!-- v-model指向formData.picurl -->\n             <uni-file-picker\n             v-model=\"formData.picurl\"\n             return-type=\"object\"></uni-file-picker>\n\t\t\t<textarea placeholder=\"请输入壁纸描述\" v-model=\"formData.description\"></textarea>\t\n                    <!-- uni-data-select为官方组件，下拉数据库中的选项 -->\n                    <uni-data-select\n                    collection=\"demo-classify\"\n                    field=\"name as text,_id as value\"\r\n                    where=\"status == true\"\r\n                    orderby=\"_id desc\"\n                    v-model=\"formData.classid\"\n                    :clear=\"true\">\n                    </uni-data-select>\n                    {{formData}}\n                 \n\t\t\t<view class=\"group\">\n\t\t\t\t<button type=\"primary\" size=\"mini\" @click=\"onSubmit\" :disabled=\"disabled\">提交</button>\n\t\t\t\t<button type=\"default\" size=\"mini\" @click=\"onCancel\">取消</button>\n\t\t\t</view>\t\n\t\t</view>\n\t</uni-popup>\n</template>\n\n<script setup>\nimport { computed, ref } from 'vue';\r\nimport { onReachBottom } from \"@dcloudio/uni-app\";\r\nimport dayjs from 'dayjs';\nconst db = uniCloud.database();\r\nconst udb = ref(null);\nconst popup = ref(null);\nconst formData = ref({\n\tdescription:\"\",\n\tpicurl:{},\n    classid:\"\",\n})\r\n\r\n\r\n\r\nconst colList = ref([\r\n    db.collection(\"demo-wallper\").orderBy(\"createTime desc\").getTemp(),\r\n    db.collection(\"demo-classify\").getTemp()\r\n])\r\n\nconst disabled = computed(()=>{\n    // Object.keys用于获取对象键名（key），返回一个字符串数组，可用来判断是否存在数据\n    if(formData.value.description && formData.value.classid &&\n    Object.keys(formData.value.picurl).length>0){\n        return false\n    }else{\n        return true\n    }\n})\n\nconst getData = async()=>{\n    // //主表\n    // let wallTemp = db.collection(\"demo-wallper\")\n    // //过滤输出内容 减少带宽  as提前重命名 \n    // .field(\"_id,description,classid,classname,createTime,picurl.url as url\")\n    // .orderBy(\"createTime desc\")\n    // .getTemp();\n    // // let {result:{data,errCode}} = await db.collection(\"demo-wallper\")\n    \n    // // 副表\n    // let classTemp = db.collection(\"demo-classify\").field(\"_id,name\").getTemp();\n    \n    // //联表 \n    // // let res = await db.collection(wallTemp,classTemp)\n    // //解构 res\n    // let {result:{errCode,data}} = await db.collection(wallTemp,classTemp)\n    // .field(\"description,url,classid.name as classname,createTime\")\n    // .get();\n    \n    // // console.log(data);\n    // // 判断errCode是否正确获取\n    // // if(errCode == 0){\n    // //     listData.value = data\n    // // }\n}\n\nconst preview = (url) =>{\r\n    uni.previewImage({\r\n        urls:[url]\r\n    })\r\n}\r\n\nconst handleAdd = ()=>{\n\tpopup.value.open();\n}\n\nconst onSubmit = async()=>{\t\n    uni.showLoading();\n    let res = await db.collection(\"demo-wallper\").add(formData.value);\n    uni.showToast({\n        title:\"添加成功\",\n        icon:'none'\n    })\n    init();\n \n    onCancel();\n    console.log(res);\n}\n\nconst onCancel = ()=>{\n\tpopup.value.close();\n}\n\nconst init = ()=>{\n\tformData.value = {\n\t\tdescription:\"\",\n\t\tpicurl:{},\n\t\tclassid:\"\",\n\t}\n}\n\n\nonReachBottom(()=>{\r\n    udb.value.loadMore();\r\n})\n\n</script>\n\n<style lang=\"scss\" scoped>\n.layout{\n\tpadding:30rpx;\n\t.add{\n\t\tmargin-bottom:30rpx;\n\t}\n\t.list{\n\t\t.item{\n\t\t\tpadding:15rpx 0;\n\t\t\tborder-top:1px solid #eee;\n\t\t\tdisplay: flex;\n\t\t\t.left{\n\t\t\t\twidth: 200rpx;\n\t\t\t\theight: 200rpx;\n\t\t\t\timage{\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\theight: 100%;\n\t\t\t\t\tborder-radius: 8rpx;\n\t\t\t\t}\n\t\t\t}\n\t\t\t.right{\n\t\t\t\tflex:1;\n\t\t\t\tpadding-left:30rpx;\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-direction: column;\n\t\t\t\tjustify-content: space-between;\n\t\t\t\t.desc{\n\t\t\t\t\tfont-size: 30rpx;\n\t\t\t\t\tline-height: 1.6em;\n\t\t\t\t}\n\t\t\t\t.classname{\n\t\t\t\t\tfont-size: 28rpx;\n\t\t\t\t\tcolor:#999;\n\t\t\t\t\tpadding-top:20rpx;\n                    display: flex;\n                    align-items: center;\n                    justify-content: space-between;\n                    }\n\t\t\t}\n\t\t}\n\t\t.item:last-child{\n\t\t\tborder-bottom:1px solid #eee;\n\t\t}\n\t}\n}\n.popupOut{\n\twidth: 660rpx;\n\tbackground: #fff;\n\tborder-radius: 10rpx;\n\tmin-height: 400rpx;\n\tpadding:30rpx;\n\tbox-sizing: border-box;\n\ttextarea{\n\t\tborder:1px solid #efefef;\n\t\tpadding:10rpx;\n\t\twidth: 100%;\n\t\theight: 150rpx;\n\t\tbox-sizing: border-box;\n\t\tmargin:30rpx 0;\n\t}\n\t.group{\n\t\tpadding-top:60rpx;\n\t\tpadding-bottom:30rpx;\n\t\tgap:30rpx;\n\t\tdisplay: flex;\n\t\tbutton{\n\t\t\twidth: 100%;\n\t\t}\n\t}\n}\n</style>","import MiniProgramPage from 'D:/uni-app/uniCloudDemo0717/pages/wallpaper/piclist.vue'\nwx.createPage(MiniProgramPage)"],"names":["uniCloud","ref","computed","uni","onReachBottom"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAiFA,UAAM,KAAKA,cAAAA,GAAS;AACpB,UAAM,MAAMC,cAAAA,IAAI,IAAI;AACpB,UAAM,QAAQA,cAAAA,IAAI,IAAI;AACtB,UAAM,WAAWA,cAAAA,IAAI;AAAA,MACpB,aAAY;AAAA,MACZ,QAAO,CAAE;AAAA,MACN,SAAQ;AAAA,IACZ,CAAC;AAID,UAAM,UAAUA,cAAAA,IAAI;AAAA,MAChB,GAAG,WAAW,cAAc,EAAE,QAAQ,iBAAiB,EAAE,QAAS;AAAA,MAClE,GAAG,WAAW,eAAe,EAAE,QAAS;AAAA,IAC5C,CAAC;AAED,UAAM,WAAWC,cAAQ,SAAC,MAAI;AAE1B,UAAG,SAAS,MAAM,eAAe,SAAS,MAAM,WAChD,OAAO,KAAK,SAAS,MAAM,MAAM,EAAE,SAAO,GAAE;AACxC,eAAO;AAAA,MACf,OAAS;AACD,eAAO;AAAA,MACV;AAAA,IACL,CAAC;AA4BD,UAAM,UAAU,CAAC,QAAO;AACpBC,oBAAAA,MAAI,aAAa;AAAA,QACb,MAAK,CAAC,GAAG;AAAA,MACjB,CAAK;AAAA,IACL;AAEA,UAAM,YAAY,MAAI;AACrB,YAAM,MAAM;IACb;AAEA,UAAM,WAAW,YAAS;AACtBA,oBAAG,MAAC,YAAW;AACf,UAAI,MAAM,MAAM,GAAG,WAAW,cAAc,EAAE,IAAI,SAAS,KAAK;AAChEA,oBAAAA,MAAI,UAAU;AAAA,QACV,OAAM;AAAA,QACN,MAAK;AAAA,MACb,CAAK;AACD;AAEA;AACAA,oBAAAA,MAAA,MAAA,OAAA,sCAAY,GAAG;AAAA,IACnB;AAEA,UAAM,WAAW,MAAI;AACpB,YAAM,MAAM;IACb;AAEA,UAAM,OAAO,MAAI;AAChB,eAAS,QAAQ;AAAA,QAChB,aAAY;AAAA,QACZ,QAAO,CAAE;AAAA,QACT,SAAQ;AAAA,MACR;AAAA,IACF;AAGAC,kBAAAA,cAAc,MAAI;AACd,UAAI,MAAM;IACd,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC1KD,GAAG,WAAW,eAAe;"}