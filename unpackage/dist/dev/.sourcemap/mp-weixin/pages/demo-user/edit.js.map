{"version":3,"file":"edit.js","sources":["pages/demo-user/edit.vue","E:/movie/HBuilderX.4.57.2025032507/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvZGVtby11c2VyL2VkaXQudnVl"],"sourcesContent":["<template>\n  <view class=\"uni-container\">\n    <uni-forms ref=\"form\" :model=\"formData\" validate-trigger=\"submit\" err-show-type=\"toast\">\n      <uni-forms-item name=\"name\" label=\"姓名\" required>\n        <uni-easyinput placeholder=\"请输入姓名\" v-model=\"formData.name\"></uni-easyinput>\n      </uni-forms-item>\n      <uni-forms-item name=\"age\" label=\"年龄\">\n        <picker @change=\"pickerChange($event, 'age')\" :range=\"formOptions.age_data\" :value=\"formOptions.age_index\">\n          <view>{{formOptions.age_data[formOptions.age_index] || \"请选择...\"}}</view>\n        </picker>\n      </uni-forms-item>\n      <uni-forms-item name=\"gender\" label=\"性别\">\n        <uni-data-checkbox v-model=\"formData.gender\" :localdata=\"formOptions.gender_localdata\"></uni-data-checkbox>\n      </uni-forms-item>\n      <uni-forms-item name=\"avatar\" label=\"头像\">\n        <uni-file-picker return-type=\"object\" v-model=\"formData.avatar\"></uni-file-picker>\n      </uni-forms-item>\n      <view class=\"uni-button-group\">\n        <button type=\"primary\" class=\"uni-button\" @click=\"submit\">提交</button>\n      </view>\n    </uni-forms>\n  </view>\n</template>\n\n<script>\n  import { validator } from '../../js_sdk/validator/demo-user.js';\n\n  const db = uniCloud.database();\n  const dbCollectionName = 'demo-user';\n\n  function getValidator(fields) {\n    let result = {}\n    for (let key in validator) {\n      if (fields.indexOf(key) > -1) {\n        result[key] = validator[key]\n      }\n    }\n    return result\n  }\n\n  function numberRange(start, end) {\n    return Array.from(new Array(end + 1).keys()).slice(start);\n  }\n\n  export default {\n    data() {\n      let formData = {\n        \"name\": \"\",\n        \"age\": 18,\n        \"gender\": 0,\n        \"avatar\": null\n      }\n      return {\n        formData,\n        formOptions: {\n          \"age_data\": numberRange(18, 35),\n          \"age_index\": 18,\n          \"gender_localdata\": [\n            {\n              \"text\": \"保密\",\n              \"value\": 0\n            },\n            {\n              \"text\": \"男\",\n              \"value\": 1\n            },\n            {\n              \"text\": \"女\",\n              \"value\": 2\n            }\n          ]\n        },\n        rules: {\n          ...getValidator(Object.keys(formData))\n        }\n      }\n    },\n    onLoad(e) {\n      if (e.id) {\n        const id = e.id\n        this.formDataId = id\n        this.getDetail(id)\n      }\n    },\n    onReady() {\n      this.$refs.form.setRules(this.rules)\n    },\n    methods: {\n      pickerChange(e, name) {\n        this.formOptions[name + '_index'] = e.detail.value;\n        this.formData[name] = this.formOptions[name + '_data'][e.detail.value];\n        this.binddata(name, this.formData[name]);\n      },\n      /**\n       * 验证表单并提交\n       */\n      submit() {\n        uni.showLoading({\n          mask: true\n        })\n        this.$refs.form.validate().then((res) => {\n          return this.submitForm(res)\n        }).catch(() => {\n        }).finally(() => {\n          uni.hideLoading()\n        })\n      },\n\n      /**\n       * 提交表单\n       */\n      submitForm(value) {\n        // 使用 clientDB 提交数据\n        return db.collection(dbCollectionName).doc(this.formDataId).update(value).then((res) => {\n          uni.showToast({\n            icon: 'none',\n            title: '修改成功'\n          })\n          this.getOpenerEventChannel().emit('refreshData')\n          setTimeout(() => uni.navigateBack(), 500)\n        }).catch((err) => {\n          uni.showModal({\n            content: err.message || '请求服务失败',\n            showCancel: false\n          })\n        })\n      },\n\n      /**\n       * 获取表单数据\n       * @param {Object} id\n       */\n      getDetail(id) {\n        uni.showLoading({\n          mask: true\n        })\n        db.collection(dbCollectionName).doc(id).field(\"name,age,gender,avatar\").get().then((res) => {\n          const data = res.result.data[0]\n          if (data) {\n            this.formData = data\n            for (let key in this.formOptions) {\n              let pickerIndex = key.lastIndexOf(\"_index\")\n              if (pickerIndex > -1) {\n                let fieldName = key.substring(0, pickerIndex)\n                let fieldData = this.formOptions[fieldName + \"_data\"];\n                if (data[fieldName] && fieldData && fieldData.indexOf(data[fieldName]) > -1) {\n                  this.formOptions[fieldName + \"_index\"] = fieldData.indexOf(data[fieldName])\n                }\n              }\n            }\n          }\n        }).catch((err) => {\n          uni.showModal({\n            content: err.message || '请求服务失败',\n            showCancel: false\n          })\n        }).finally(() => {\n          uni.hideLoading()\n        })\n      }\n    }\n  }\n</script>\n\n<style>\n  .uni-container {\n    padding: 15px;\n  }\n\n  .uni-input-border,\n  .uni-textarea-border {\n    width: 100%;\n    font-size: 14px;\n    color: #666;\n    border: 1px #e5e5e5 solid;\n    border-radius: 5px;\n    box-sizing: border-box;\n  }\n\n  .uni-input-border {\n    padding: 0 10px;\n    height: 35px;\n\n  }\n\n  .uni-textarea-border {\n    padding: 10px;\n    height: 80px;\n  }\n\n  .uni-button-group {\n    margin-top: 50px;\n    /* #ifndef APP-NVUE */\n    display: flex;\n    /* #endif */\n    justify-content: center;\n  }\n\n  .uni-button {\n    width: 184px;\n  }\n</style>\n","import MiniProgramPage from 'D:/uni-app/uniCloudDemo0717/pages/demo-user/edit.vue'\nwx.createPage(MiniProgramPage)"],"names":["uniCloud","validator","uni"],"mappings":"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"}