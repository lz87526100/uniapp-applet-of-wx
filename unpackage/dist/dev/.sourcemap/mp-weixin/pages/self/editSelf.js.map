{"version":3,"file":"editSelf.js","sources":["pages/self/editSelf.vue","E:/movie/HBuilderX.4.57.2025032507/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc2VsZi9lZGl0U2VsZi52dWU"],"sourcesContent":["<template>\n    <view class=\"edit-self\">\n        <!-- 顶部导航栏        <view class=\"navbar\">\n            <view class=\"navbar-content\" :style=\"{ height: getNavBarHeight() + 'px' }\">\n                <view class=\"navbar-left\" @click=\"handleBack\">\n                    <uni-icons type=\"arrowleft\" size=\"24\" color=\"#000\"></uni-icons>\n                </view>\n                <view class=\"navbar-title\">编辑个人信息</view>\n                <view class=\"navbar-right\"></view>\n            </view>\n        </view>-->\n \n\n        <!-- 内容区域 -->\n        <view class=\"content\">\n            <!-- 加载状态 -->\n            <view v-if=\"state.loading\" class=\"loading\">\n                <uni-load-more status=\"loading\" content=\"加载中...\"></uni-load-more>\n            </view>\n\n            <!-- 内容 -->\n            <view v-else>\n                <!-- 头像编辑 -->\n                <view class=\"form-item\">\n                    <view class=\"label\">头像</view>\n                    <view class=\"avatar-section\">\n                        <view class=\"avatar-wrapper\" @click=\"changeAvatar\">\n                            <image :src=\"state.formData.avatar\" mode=\"aspectFill\" class=\"avatar\"></image>\n                            <view class=\"avatar-mask\">\n                                <uni-icons type=\"camera\" size=\"24\" color=\"#fff\"></uni-icons>\n                            </view>\n                        </view>\n                    </view>\n                </view>\n\n                <!-- 用户名编辑 -->\n                <view class=\"form-item\">\n                    <view class=\"label\">用户名</view>\n                    <input \n                        v-model=\"state.formData.nickname\" \n                        class=\"input\" \n                        placeholder=\"请输入用户名\"\n                        maxlength=\"20\"\n                        placeholder-style=\"color: #ccc\"\n                        @blur=\"handleNicknameBlur\" />\n                </view>\n\n                <!-- 分隔线 -->\n                <view class=\"divider\"></view>\n\n                <!-- 只读信息 -->\n                <view class=\"readonly-info\">\n                    <view class=\"info-item\">\n                        <view class=\"info-label\">用户ID</view>\n                        <view class=\"info-value\">{{ state.userInfo._id || '--' }}</view>\n                    </view>\n                    \n                    <view class=\"info-item\">\n                        <view class=\"info-label\">创建时间</view>\n                        <view class=\"info-value\">{{ formatDate(state.userInfo.register_date) }}</view>\n                    </view>\n                    \n                    <view class=\"info-item\">\n                        <view class=\"info-label\">最后登录IP</view>\n                        <view class=\"info-value\">{{ state.userInfo.last_login_ip || '--' }}</view>\n                    </view>\n                </view>\n            </view>\n        </view>\n    </view>\n</template>\n\n<script setup>\nimport { reactive, onUnmounted } from 'vue'\nimport { onLoad, onHide, onShow, onUnload } from '@dcloudio/uni-app'\nimport { getNavBarHeight } from \"@/utils/system.js\";\n\n// 使用 reactive 管理状态\nconst state = reactive({\n    loading: false,\n    userId: '',\n    formData: {\n        nickname: '',\n        avatar: '/static/logo.png'\n    },\n    userInfo: {\n        _id: '',\n        register_date: 0,\n        last_login_ip: ''\n    },\n    // 记录数据是否有更新\n    hasUpdates: false,\n    updatedData: {\n        avatar: '',\n        nickname: ''\n    },\n    originalData: {\n        nickname: '',\n        avatar: ''\n    }\n})\n\n// 页面加载\nonLoad((options) => {\n    console.log('页面加载，参数:', options)\n    \n    // 直接从存储获取用户信息\n    const currentUserInfo = uni.getStorageSync('uni-id-pages-userInfo')\n    console.log('存储的用户信息:', currentUserInfo)\n    \n    if (currentUserInfo && currentUserInfo._id) {\n        state.userId = currentUserInfo._id\n        console.log('设置用户ID为:', state.userId)\n        loadUserInfo()\n    } else {\n        console.error('未找到用户信息')\n        uni.showToast({\n            title: '请先登录',\n            icon: 'none'\n        })\n        setTimeout(() => {\n            uni.navigateBack()\n        }, 1500)\n    }\n})\n\n// 页面显示时也触发一次数据同步\nonShow(() => {\n    console.log('编辑页面显示，检查数据同步')\n    if (state.userId) {\n        loadUserInfo() // 重新加载确保数据最新\n    }\n})\n\n// 页面隐藏时返回数据（在返回时触发）\nonHide(() => {\n    console.log('页面隐藏，返回数据')\n    returnDataToPreviousPage()\n})\n\n// 页面卸载时返回数据\nonUnload(() => {\n    console.log('页面卸载，返回数据')\n    returnDataToPreviousPage()\n})\n\n// 组件卸载时返回数据\nonUnmounted(() => {\n    console.log('页面卸载，返回数据')\n    returnDataToPreviousPage()\n})\n\n// 返回按钮处理\nconst handleBack = () => {\n    console.log('返回按钮点击')\n    returnDataToPreviousPage()\n    uni.navigateBack()\n}\n\n// 返回数据给上一页\nconst returnDataToPreviousPage = () => {\n    if (state.hasUpdates) {\n        console.log('有数据更新，发送给上一页')\n        \n        const updateData = {\n            userId: state.userId,\n            avatar: state.updatedData.avatar || state.formData.avatar,\n            nickname: state.updatedData.nickname || state.formData.nickname\n        }\n        \n        // 方法1：使用全局事件（最可靠的方式）\n        uni.$emit('userInfoUpdated', updateData)\n        console.log('通过全局事件发送数据:', updateData)\n        \n        // 方法2：使用页面事件通道\n        const eventChannel = this.getOpenerEventChannel()\n        if (eventChannel) {\n            eventChannel.emit('userInfoUpdated', updateData)\n            console.log('通过事件通道发送数据')\n        }\n        \n        // 方法3：存储到全局数据中\n        getApp().globalData.lastUserInfoUpdate = updateData\n        \n        // 方法4：存储到本地存储\n        uni.setStorageSync('lastUserInfoUpdate', updateData)\n        \n        // 重置更新状态\n        state.hasUpdates = false\n        \n        // 显示更新提示\n        uni.showToast({\n            title: '资料已更新',\n            icon: 'success',\n            duration: 1500\n        })\n    }\n}\n\n// 加载用户信息\nconst loadUserInfo = async () => {\n    state.loading = true\n    try {\n        console.log('加载用户信息，用户ID:', state.userId)\n        const articlesCloudObj = uniCloud.importObject('articlesCloudObj')\n        const result = await articlesCloudObj.getUserInfoById(state.userId)\n        \n        console.log('用户信息加载结果:', result)\n        \n        if (result.errCode === 0 && result.data) {\n            const userData = result.data\n            \n            // 设置表单数据\n            state.formData.nickname = userData.nickname || ''\n            state.formData.avatar = userData.avatar_url || '/static/logo.png'\n            \n            // 设置只读信息\n            state.userInfo._id = userData._id || state.userId\n            state.userInfo.register_date = userData.register_date || 0\n            state.userInfo.last_login_ip = userData.last_login_ip || '--'\n            \n            // 初始化原始数据和更新数据\n            state.originalData.nickname = state.formData.nickname\n            state.originalData.avatar = state.formData.avatar\n            state.updatedData.nickname = state.formData.nickname\n            state.updatedData.avatar = state.formData.avatar\n            \n            console.log('用户信息设置完成')\n        } else {\n            throw new Error(result.errMsg || '获取用户信息失败')\n        }\n    } catch (error) {\n        console.error('加载用户信息失败:', error)\n        uni.showToast({\n            title: '加载失败',\n            icon: 'none'\n        })\n    } finally {\n        state.loading = false\n    }\n}\n\n// 修改头像\nconst changeAvatar = async () => {\n    console.log('点击修改头像，用户ID:', state.userId)\n    \n    try {\n        // 直接调用 uni.chooseImage\n        uni.chooseImage({\n            count: 1,\n            sizeType: ['compressed'],\n            sourceType: ['album', 'camera'],\n            success: async (chooseResult) => {\n                console.log('选择图片成功:', chooseResult)\n                \n                if (chooseResult.tempFilePaths && chooseResult.tempFilePaths.length > 0) {\n                    const tempFilePath = chooseResult.tempFilePaths[0]\n                    console.log('选择的图片路径:', tempFilePath)\n                    \n                    // 显示上传loading\n                    uni.showLoading({\n                        title: '上传中...',\n                        mask: true\n                    })\n                    \n                    try {\n                        // 上传到云存储\n                        const uploadResult = await uniCloud.uploadFile({\n                            filePath: tempFilePath,\n                            cloudPath: `user-avatar/${state.userId}/${Date.now()}.jpg`\n                        })\n                        \n                        console.log('上传结果:', uploadResult)\n                        \n                        if (uploadResult.fileID) {\n                            // 获取永久URL\n                            let avatarUrl = tempFilePath\n                            try {\n                                const urlResult = await uniCloud.getTempFileURL({\n                                    fileList: [uploadResult.fileID]\n                                })\n                                if (urlResult.fileList && urlResult.fileList[0] && urlResult.fileList[0].tempFileURL) {\n                                    avatarUrl = urlResult.fileList[0].tempFileURL\n                                }\n                            } catch (urlError) {\n                                console.warn('获取永久URL失败，使用临时URL:', urlError)\n                            }\n                            \n                            // 更新数据库\n                            const articlesCloudObj = uniCloud.importObject('articlesCloudObj')\n                            const updateResult = await articlesCloudObj.updateUserInfo({\n                                userId: state.userId,\n                                avatarFile: uploadResult.fileID\n                            })\n                            \n                            console.log('数据库更新:', updateResult)\n                            \n                            if (updateResult.errCode === 0) {\n                                // 更新本地数据\n                                state.formData.avatar = avatarUrl\n                                state.updatedData.avatar = avatarUrl\n                                state.hasUpdates = true\n                                \n                                uni.hideLoading()\n                                uni.showToast({\n                                    title: '头像更新成功',\n                                    icon: 'success'\n                                })\n                                \n                                // 更新本地存储\n                                updateLocalUserInfo()\n                                \n                                console.log('头像更新完成，标记为有更新')\n                            } else {\n                                throw new Error(updateResult.errMsg)\n                            }\n                        } else {\n                            throw new Error('上传失败')\n                        }\n                    } catch (uploadError) {\n                        uni.hideLoading()\n                        console.error('上传失败:', uploadError)\n                        uni.showToast({\n                            title: '上传失败: ' + uploadError.message,\n                            icon: 'none'\n                        })\n                    }\n                }\n            },\n            fail: (error) => {\n                console.log('选择图片取消或失败:', error)\n                if (error.errMsg !== 'chooseImage:fail cancel') {\n                    uni.showToast({\n                        title: '选择图片失败',\n                        icon: 'none'\n                    })\n                }\n            }\n        })\n    } catch (error) {\n        console.error('头像上传异常:', error)\n    }\n}\n\n// 用户名输入框失去焦点时自动保存\nconst handleNicknameBlur = async () => {\n    if (!state.formData.nickname || !state.formData.nickname.trim()) {\n        uni.showToast({\n            title: '用户名不能为空',\n            icon: 'none'\n        })\n        // 恢复原来的昵称\n        state.formData.nickname = state.originalData.nickname\n        return\n    }\n    \n    const trimmedNickname = state.formData.nickname.trim()\n    \n    // 如果昵称没有变化，不进行保存\n    if (trimmedNickname === state.originalData.nickname) {\n        return\n    }\n    \n    state.loading = true\n    try {\n        console.log('自动保存用户名:', {\n            userId: state.userId,\n            nickname: trimmedNickname\n        })\n        \n        const articlesCloudObj = uniCloud.importObject('articlesCloudObj')\n        const updateResult = await articlesCloudObj.updateUserInfo({\n            userId: state.userId,\n            nickname: trimmedNickname\n        })\n        \n        console.log('保存结果:', updateResult)\n        \n        if (updateResult.errCode === 0) {\n            // 更新本地数据\n            state.updatedData.nickname = trimmedNickname\n            state.originalData.nickname = trimmedNickname\n            state.hasUpdates = true\n            \n            uni.showToast({\n                title: '用户名更新成功',\n                icon: 'success'\n            })\n            \n            // 更新本地存储\n            updateLocalUserInfo()\n            \n            console.log('用户名更新完成，标记为有更新')\n        } else {\n            throw new Error(updateResult.errMsg || '保存失败')\n        }\n        \n    } catch (error) {\n        console.error('保存失败:', error)\n        uni.showToast({\n            title: '保存失败: ' + error.message,\n            icon: 'none'\n        })\n        // 恢复原来的昵称\n        state.formData.nickname = state.originalData.nickname\n    } finally {\n        state.loading = false\n    }\n}\n\n// 更新本地存储\nconst updateLocalUserInfo = () => {\n    try {\n        const userInfoFromStorage = uni.getStorageSync('uni-id-pages-userInfo')\n        if (userInfoFromStorage) {\n            userInfoFromStorage.nickname = state.formData.nickname.trim()\n            if (state.updatedData.avatar) {\n                userInfoFromStorage.avatar = state.updatedData.avatar\n            }\n            uni.setStorageSync('uni-id-pages-userInfo', userInfoFromStorage)\n            console.log('本地存储更新成功')\n        }\n    } catch (error) {\n        console.error('更新本地存储失败:', error)\n    }\n}\n\n// 格式化日期\nconst formatDate = (timestamp) => {\n    if (!timestamp) return '--'\n    try {\n        const date = new Date(parseInt(timestamp))\n        return `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`\n    } catch (e) {\n        return '--'\n    }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.edit-self {\n    min-height: 100vh;\n    background-color: #f8f9fa;\n}\n\n.navbar {\n    background: #fff;\n    border-bottom: 1rpx solid #f0f0f0;\n    \n    .navbar-content {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        padding: 0 30rpx;\n        \n        .navbar-left {\n            flex: 1;\n            display: flex;\n            align-items: center;\n            \n            &:active {\n                opacity: 0.7;\n            }\n        }\n        \n        .navbar-title {\n            flex: 2;\n            text-align: center;\n            font-size: 36rpx;\n            font-weight: 600;\n            color: #333;\n        }\n        \n        .navbar-right {\n            flex: 1;\n        }\n    }\n}\n\n.content {\n    padding: 30rpx;\n}\n\n.loading {\n    padding: 100rpx 0;\n    text-align: center;\n}\n\n/* 表单项目 */\n.form-item {\n    background: #fff;\n    padding: 30rpx;\n    border-radius: 16rpx;\n    margin-bottom: 20rpx;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    \n    .label {\n        font-size: 32rpx;\n        color: #333;\n        font-weight: 500;\n        flex-shrink: 0;\n        width: 200rpx;\n    }\n    \n    .avatar-section {\n        .avatar-wrapper {\n            position: relative;\n            width: 120rpx;\n            height: 120rpx;\n            border-radius: 50%;\n            overflow: visible;\n            border: 4rpx solid #f0f0f0;\n            \n            /* 确保可点击 */\n            cursor: pointer;\n            -webkit-tap-highlight-color: transparent;\n            \n            .avatar {\n                width: 100%;\n                height: 100%;\n                border-radius: 50%;\n                object-fit: cover;\n            }\n            \n            .avatar-mask {\n                position: absolute;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                background: rgba(0, 0, 0, 0.5);\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                opacity: 0;\n                transition: opacity 0.3s ease;\n                border-radius: 50%;\n            }\n            \n            /* 点击反馈 */\n            &:active .avatar-mask {\n                opacity: 1;\n            }\n        }\n    }\n}\n\n.input {\n    flex: 1;\n    text-align: right;\n    font-size: 32rpx;\n    color: #333;\n    padding: 20rpx;\n    background: transparent;\n    border: none;\n    outline: none;\n    \n    &::placeholder {\n        color: #ccc;\n    }\n}\n\n.divider {\n    height: 20rpx;\n    background: transparent;\n}\n\n.readonly-info {\n    background: #fff;\n    border-radius: 16rpx;\n    overflow: hidden;\n    \n    .info-item {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        padding: 30rpx;\n        border-bottom: 1rpx solid #f0f0f0;\n        \n        &:last-child {\n            border-bottom: none;\n        }\n        \n        .info-label {\n            font-size: 30rpx;\n            color: #666;\n            flex-shrink: 0;\n            width: 200rpx;\n        }\n        \n        .info-value {\n            font-size: 28rpx;\n            color: #999;\n            text-align: right;\n            flex: 1;\n            margin-left: 20rpx;\n            word-break: break-all;\n        }\n    }\n}\n</style>","import MiniProgramPage from 'D:/uni-app/uniCloudDemo0717/pages/self/editSelf.vue'\nwx.createPage(MiniProgramPage)"],"names":["reactive","onLoad","uni","onShow","onHide","onUnload","onUnmounted","uniCloud"],"mappings":"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"}