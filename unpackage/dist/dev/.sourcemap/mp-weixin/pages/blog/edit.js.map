{"version":3,"file":"edit.js","sources":["pages/blog/edit.vue","E:/movie/HBuilderX.4.57.2025032507/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvYmxvZy9lZGl0LnZ1ZQ"],"sourcesContent":["<template>\n\t<view class=\"layout\">\n\t\t<view class=\"content\">\n\t\t\t<textarea class=\"textarea\" placeholder=\"说点什么吧...\" auto-height :maxlength=\"600\" v-model=\"formData.content\"></textarea>\n\t\t</view>\n\t\t\n\t\t<view class=\"pics\">\n\t\t\t<uni-file-picker \n\t\t\t\tv-model=\"formData.pics\" \n\t\t\t\tfileMediatype=\"image\" \n\t\t\t\tmode=\"grid\"\t\t\t\t\n\t\t\t/>\n\t\t</view>\n\t\t\n\t\t<view class=\"btns\">\n\t\t\t<button type=\"primary\" plain :disabled=\"btnDisabled\" @click=\"onSubmit\">提交</button>\t\t\t\n\t\t</view>\t\t\n\t</view>\n</template>\n\n<script setup>\nimport { computed, ref } from 'vue';\n\n// ✅ 正确导入云对象\nconst articlesCloudObj = uniCloud.importObject(\"articlesCloudObj\");\n\nconst formData = ref({\n\tcontent: \"\",\n\tpics: []\n});\n\nconst btnDisabled = computed(() => !(formData.value.content.length > 0 || formData.value.pics.length > 0));\n\nconst onSubmit = async () => {\n\tconsole.log(\"提交数据\", formData.value);\n    \n    // ✅ 过滤图片数据\n    const params = {\n        ...formData.value,\n        pics: formData.value.pics.map(item => ({\n\t\t\tname: item.name,\n\t\t\textname: item.extname,\n\t\t\turl: item.url\n\t\t})),\n\t\tpublish_date: Date.now() // 添加发布时间字段，用于排序\n    };\n\t\n\ttry {\n\t\t// ✅ 正确调用云对象的 add 方法\n\t\tconst result = await articlesCloudObj.add(params);\n\t\tconsole.log(\"返回结果\", result);\n\t\t\n\t\tif (result.errCode === 0) {\n\t\t\tuni.showToast({\n\t\t\t\ttitle: \"发布成功\",\n\t\t\t\ticon: \"none\"\n\t\t\t});\n\t\t\t//销毁跳转\r\n            // setTimeout(()=>{\r\n            //     uni.redirectTo({\r\n            //         url:\"/pages/blog/list\"\r\n            //     })\r\n            // },1000)\r\n            //list页面的事件发送\r\n            setTimeout(()=>{\r\n            uni.$emit(\"editEvent\");\r\n            uni.navigateBack();\r\n            },100)    \r\n            \n\t\t\t// 清空表单\n\t\t\tformData.value.content = \"\";\n\t\t\tformData.value.pics = [];\n\t\t} else {\n\t\t\tuni.showToast({\n\t\t\t\ttitle: \"发布失败：\" + (result.errMsg || result.message || \"未知错误\"),\n\t\t\t\ticon: \"none\",\n\t\t\t\tduration: 3000\n\t\t\t});\n\t\t}\n\t} catch (error) {\n\t\tconsole.error(\"调用失败\", error);\n\t\tuni.showToast({\n\t\t\ttitle: \"网络错误：\" + error.message,\n\t\t\ticon: \"none\"\n\t\t});\n\t}\n};\n\nconst onUploadSuccess = (e) => {\n\tconsole.log(\"上传成功\", e);\n};\n\nconst onUploadFail = (err) => {\n\tconsole.error(\"上传失败\", err);\n};\n\n</script>\n\n<style lang=\"scss\" scoped>\n.layout{\n\t.content {\n\t\tpadding: 30rpx;\t\n\t\t.textarea {\n\t\t\tfont-size: 38rpx;\n\t\t\twidth: 100%;\n\t\t\tline-height: 1.7em;\n\t\t\tmin-height: 200rpx;\n\t\t}\n\t}\n\t.pics{\n\t\tpadding:30rpx;\n\t}\n\t.btns{\n\t\tpadding:30rpx;\t\t\n\t\tbutton{\n\t\t\twidth: 100%;\n\t\t}\n\t}\n}\n</style>","import MiniProgramPage from 'D:/uni-app/uniCloudDemo0717/pages/blog/edit.vue'\nwx.createPage(MiniProgramPage)"],"names":["uniCloud","ref","computed","uni"],"mappings":";;;;;;;;;;;;;AAwBA,UAAM,mBAAmBA,cAAQ,GAAC,aAAa,kBAAkB;AAEjE,UAAM,WAAWC,cAAAA,IAAI;AAAA,MACpB,SAAS;AAAA,MACT,MAAM,CAAE;AAAA,IACT,CAAC;AAED,UAAM,cAAcC,cAAAA,SAAS,MAAM,EAAE,SAAS,MAAM,QAAQ,SAAS,KAAK,SAAS,MAAM,KAAK,SAAS,EAAE;AAEzG,UAAM,WAAW,YAAY;AAC5BC,oBAAA,MAAA,MAAA,OAAA,6BAAY,QAAQ,SAAS,KAAK;AAG/B,YAAM,SAAS;AAAA,QACX,GAAG,SAAS;AAAA,QACZ,MAAM,SAAS,MAAM,KAAK,IAAI,WAAS;AAAA,UAC5C,MAAM,KAAK;AAAA,UACX,SAAS,KAAK;AAAA,UACd,KAAK,KAAK;AAAA,QACb,EAAI;AAAA,QACF,cAAc,KAAK,IAAK;AAAA;AAAA,MAC1B;AAEC,UAAI;AAEH,cAAM,SAAS,MAAM,iBAAiB,IAAI,MAAM;AAChDA,sBAAY,MAAA,MAAA,OAAA,6BAAA,QAAQ,MAAM;AAE1B,YAAI,OAAO,YAAY,GAAG;AACzBA,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO;AAAA,YACP,MAAM;AAAA,UACV,CAAI;AAQQ,qBAAW,MAAI;AACfA,gCAAI,MAAM,WAAW;AACrBA,0BAAG,MAAC,aAAY;AAAA,UACf,GAAC,GAAG;AAGd,mBAAS,MAAM,UAAU;AACzB,mBAAS,MAAM,OAAO;QACzB,OAAS;AACNA,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO,WAAW,OAAO,UAAU,OAAO,WAAW;AAAA,YACrD,MAAM;AAAA,YACN,UAAU;AAAA,UACd,CAAI;AAAA,QACD;AAAA,MACD,SAAQ,OAAO;AACfA,sBAAc,MAAA,MAAA,SAAA,6BAAA,QAAQ,KAAK;AAC3BA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO,UAAU,MAAM;AAAA,UACvB,MAAM;AAAA,QACT,CAAG;AAAA,MACD;AAAA,IACF;;;;;;;;;;;;;;;;;;ACrFA,GAAG,WAAW,eAAe;"}